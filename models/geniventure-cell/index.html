<html>
  <head>
    <script type="text/javascript" src="../../organelle.js" charset="utf-8"></script>
    <style media="screen" type="text/css">
      .model {
        position: absolute;
        left: 0;
        top: 0;
        height: 100vh;
        width: 160vh;
        opacity: 1;
        -webkit-transition: opacity 5s;
        transition: opacity 5s;
      }

      .hidden-iframe {
        width: 0;
        height: 0;
        opacity: 0;
      }

      .temp-iframe {
        opacity: 0;
      }

      iframe {
        position: absolute;
        width: 100%;
        height: 100%;
        border: none;
      }

      #close-protein-game {
        position: absolute;
        bottom: 2vh;
        left: 140vh;
      }

      #world-props {
        position: absolute;
        left: 161vh;
        bottom: 1vh;
      }
    </style>
  </head>
  <body>
    <svg id="model" viewBox="0 0 1280 800" class="model">
      <defs>
        <linearGradient id="_Linear1" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(36.2293,-24.1603,24.1603,36.2293,1060.13,173.308)"><stop offset="0" style="stop-color:rgb(178,166,97);stop-opacity:1"/><stop offset="0.1" style="stop-color:rgb(178,166,97);stop-opacity:1"/><stop offset="1" style="stop-color:rgb(185,177,81);stop-opacity:0"/></linearGradient>
        <linearGradient id="_Linear2" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(-25.1361,-72.1116,72.1116,-25.1361,408.309,71.7374)"><stop offset="0" style="stop-color:rgb(178,166,97);stop-opacity:1"/><stop offset="0.1" style="stop-color:rgb(178,166,97);stop-opacity:1"/><stop offset="1" style="stop-color:rgb(185,177,81);stop-opacity:0"/></linearGradient>
        <linearGradient id="_Linear3" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(-42.1529,-10.8963,10.8963,-42.1529,17.646,623.599)"><stop offset="0" style="stop-color:rgb(178,166,97);stop-opacity:1"/><stop offset="0.1" style="stop-color:rgb(178,166,97);stop-opacity:1"/><stop offset="1" style="stop-color:rgb(185,177,81);stop-opacity:0"/></linearGradient>
        <linearGradient id="_Linear4" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(60.1877,-46.9848,46.9848,60.1877,1173.93,518.302)"><stop offset="0" style="stop-color:rgb(178,166,97);stop-opacity:1"/><stop offset="0.1" style="stop-color:rgb(178,166,97);stop-opacity:1"/><stop offset="1" style="stop-color:rgb(185,177,81);stop-opacity:0"/></linearGradient>
        <radialGradient id="_Radial5" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="matrix(1.707,0.165538,-0.160701,1.56159,673.325,230.223)"><stop offset="0" style="stop-color:rgb(204,51,102);stop-opacity:1"/><stop offset="1" style="stop-color:rgb(207,126,167);stop-opacity:1"/></radialGradient>
        <radialGradient id="_Radial1" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="matrix(16.4871,0,0,-16.4871,15.5554,16.1143)"><stop offset="0" style="stop-color:rgb(255,206,180);stop-opacity:0.105882"/><stop offset="0.53" style="stop-color:rgb(255,206,180);stop-opacity:0.2"/><stop offset="1" style="stop-color:rgb(251,192,162);stop-opacity:1"/></radialGradient>
        <radialGradient id="_Radial2" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="matrix(16.4871,0,0,-16.4871,15.5554,16.1143)"><stop offset="0" style="stop-color:rgb(255,206,180);stop-opacity:0.2"/><stop offset="0.45" style="stop-color:rgb(255,206,180);stop-opacity:0.3"/><stop offset="1" style="stop-color:rgb(237,107,42);stop-opacity:1"/></radialGradient>
        <radialGradient id="_Radial3" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="matrix(16.4871,0,0,-16.4871,15.5554,16.1143)"><stop offset="0" style="stop-color:rgb(255,206,180);stop-opacity:0.3"/><stop offset="0.3" style="stop-color:rgb(255,206,180);stop-opacity:0.4"/><stop offset="1" style="stop-color:rgb(171,74,25);stop-opacity:1"/></radialGradient>
        <radialGradient id="_Radial4" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="matrix(16.4871,0,0,-16.4871,15.5554,16.1143)"><stop offset="0" style="stop-color:rgb(255,206,180);stop-opacity:0.5"/><stop offset="0.1" style="stop-color:rgb(255,206,180);stop-opacity:0.8"/><stop offset="1" style="stop-color:rgb(53,28,16);stop-opacity:1"/></radialGradient>
      </defs>
    </svg>
    <div id="protein-game-wrapper" class="model hidden-iframe">
      <iframe id="protein-game"></iframe>
      <button id="close-protein-game">Zoom back to cell</button>
    </div>

    <fieldset id="world-props">
      <legend>Cell props</legend>
      <input id="working_tyr1" type="checkbox" checked="checked"/><label for="working_tyr1">working_tyr1</label><br/>
      <input id="working_myosin_5a" type="checkbox" checked="checked"/><label for="working_tyr1">working_myosin_5a</label>
    </fieldset>

    <script>
      var model;

      Organelle.createModel({
        element: "model",
        background: {
          file: "assets/melanocyte.svg",
          selector: "#cell"
        },
        properties: {
          working_tyr1: true,
          working_myosin_5a: true
        },
        species: [
          "organelles/melanosome.yml"
        ],
        clickHandlers: [
          {
            selector: "#golgi_x5F_apparatus",
            action: enterProteinGame
          }
        ]
      }).then(function(m) {
        model = m;
      });

      function addClass(el, className) {
        if (el.classList)
          el.classList.add(className);
        else
          el.className += ' ' + className;
      }

      function removeClass(el, className) {
        if (el.classList)
          el.classList.remove(className);
        else
          el.className = el.className.replace(new RegExp('(^|\\b)' + className.split(' ').join('|') + '(\\b|$)', 'gi'), ' ');
      }


      var iframe = document.getElementById("protein-game"),
          wrapper = document.getElementById("protein-game-wrapper"),
          reverseZoom;

      function enterProteinGame(Snap, el) {
        let delay = 1500    // use delay as Snap's onComplete action doesn't always fire
        Snap.animate(el.attr("viewBox").vb.split(" "), [370, 500, 110, 69],
          function (vals) { el.attr("viewBox", vals.join(" ")); }, 1500
        );
        setTimeout( () => {
            model.stop();
            iframe.src = "https://www.fablevision.com/geniverse_proteins/";
            removeClass(wrapper, "hidden-iframe");
          }, delay)

        reverseZoom = function() {
          Snap.animate(el.attr("viewBox").vb.split(" "), [0, 0, 1280, 800],
            function (vals) { el.attr("viewBox", vals.join(" ")); }, 1500
          );
        }
      }

      function exitProteinGame() {
        addClass(wrapper, "temp-iframe");
        setTimeout(function() {
          iframe.src = "";
          reverseZoom();
          model.run();
          addClass(wrapper, "hidden-iframe");
          removeClass(wrapper, "temp-iframe");
        }, 2000)
      }

      document.getElementById("close-protein-game").onclick = exitProteinGame;

      function observePropCheckbox(prop) {
        document.getElementById(prop).onclick = function() {
          model.world.setProperty(prop, document.getElementById(prop).checked)
        }
      }
      observePropCheckbox("working_tyr1");
      observePropCheckbox("working_myosin_5a");
    </script>
  </body>
</html>
