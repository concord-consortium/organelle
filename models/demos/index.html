<html>
  <head>
    <script type="text/javascript" src="../../organelle.js" charset="utf-8"></script>
  </head>
  <body>
    <h1>Organelle demos</h1>
    <fieldset style="float: left; padding: 10px">
      <legend>Spawning on element</legend>
      <svg id="spawn-model" viewBox="-20 -20 300 300" width="300px" height="300px" style="display: inline-block;"></svg>
    </fieldset>
    <fieldset style="float: left; padding: 10px">
      <legend>Following paths</legend>
      <svg id="follow-model" viewBox="-20 -20 600 300" width="600px" height="300px" style="display: inline-block;"></svg>
    </fieldset>

    <script>
      var melanosome = {
        name: "melanosome",
        image: "assets/melanosome.svg",
        selector: "#melanosome",
        spawn: {
          on: {
            selector: "#golgi_x5F_apparatus path",
            at: "random"
          },
          every: 90
        },
        rules: {
          initialization: [
            {
              set: {
                size: 0.1,
                speed: 1
              },
              switch_state: "growing"
            }
          ],
          growing: [
            {
              if: {
                fact: "world.working_tyr1",
              },
              then: [
                {
                  grow: {
                    by: 0.005,
                    until: 1,
                    finally: {
                      switch_state: "seeking_microtuble"
                    }
                  }
                },
                {
                  if: {
                    fact: "size",
                    between: [0.5, 0.7]
                  },
                  then: {
                    set_attr: {
                      selector: "#Layer1_0_FILL",
                      set: {
                        fill: "url(#_Radial2)"
                      }
                    }
                  }
                },
                {
                  if: {
                    fact: "size",
                    between: [0.7, 0.9]
                  },
                  then: {
                    set_attr: {
                      selector: "#Layer1_0_FILL",
                      set: {
                        fill: "url(#_Radial3)"
                      }
                    }
                  }
                },
                {
                  if: {
                    fact: "size",
                    greaterThan: 0.9
                  },
                  then: {
                    set_attr: {
                      selector: "#Layer1_0_FILL",
                      set: {
                        fill: "url(#_Radial4)"
                      }
                    }
                  }
                }
              ],
              else: {
                grow: {
                  by: 0.005,
                  until: 0.6,
                  finally: {
                    switch_state: "seeking_microtuble"
                  }
                }
              }
            }
          ],
          seeking_microtuble: [
            {
              move_to: {
                selector: "#microtubules_x5F_grouped path",
                which: "random",
                finally: {
                  switch_state: "following_microtuble"
                }
                // x: 0,
                // y: 0
              }
              // change: {
              //   prop: "x",
              //   by: 0.5
              // }
            }
          ],
          following_microtuble: [
            {
              follow: {
                selector: "#microtubules_x5F_grouped path",
                which: "nearest",
                finally: {
                  switch_state: "dying"
                }
              }
            }
          ],
          dying: [
            {
              grow: {
                by: -0.03,
                until: 0,
                finally: {
                  die: true
                }
              }
            }
          ]
        }
      }
    </script>
    <script>
      // Organelle.createModel({
      //   element: "spawn-model",
      //   background: "assets/golgi.svg",
      //   species: [
      //     melanosome
      //   ]
      // });

      var o = Organelle.createModel({
        element: "follow-model",
        background: "assets/golgi-and-microtubules.svg",
        properties: {
          working_tyr1: true
        },
        species: [
          melanosome
        ]
      });
    </script>
  </body>
</html>
